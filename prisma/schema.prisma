generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          			Int       		@id @default(autoincrement())
  email       			String    		@unique(map: "User_email_key")
  password    			String?
  inviteToken 			String    		@unique(map: "User_inviteToken_key")
  role        			user_role 		@default(USER)
  status      			Boolean   		@default(false)
  createdAt   			DateTime  		@default(now())
  balance     			Float     		@default(0)
	fundsBlocked			Float     		@default(0)
	payInGambling			Float     		@default(0)
	payOutGambling		Float   			@default(0)
	payInExchangers		Float     		@default(0)
	payOutExchangers	Float   			@default(0)
	devices     			Device[]
	groups      			Group[]
	requisites    		requisites[]
	transactions  		Transaction[]
	paymentStatus 		Boolean   		@default(false)
	receiveStatus 		Boolean   		@default(false)
}

model Device {
	id          	Int       @id @default(autoincrement())
	user    			User      @relation(fields: [userId], references: [id])
	userId      	Int
	deviceId    	String    @unique(map: "Device_deviceId_key")
	name  				String
}

model Group {
	id        		Int      @id @default(autoincrement())
	token     		String   @unique(map: "Invite_token_key")
	name      		String
	user    			User     @relation(fields: [userId], references: [id])
	userId    		Int
}

model requisites {
	id							Int       @id @default(autoincrement())
	user        		User      @relation(fields: [userId], references: [id])
	userId      		Int
	currency    		currency  @relation(fields: [currencyId], references: [id])
	currencyId  		Int
	bankName    		bank_name @relation(fields: [bankId], references: [id])
	bankId  				Int
	paymentMethod   payment_method @relation(fields: [paymentId], references: [id])
	paymentId 		  Int
	cardNumber  	  String
	cardOwner  		  String
	card            String
	minOrder				Int?
	maxOrder				Int?
	dayLimit				Int?
	monthLimit			Int?
	dayQuantity			Int?
	monthQuantity		Int?
	concurrentOrder	Int?
	minutesDelay		Int?
	status      		Boolean   @default(false)
	createdAt   		DateTime  @default(now())
	transactions    Transaction[]
}

model Transaction {
	id          				Int       						@id @default(autoincrement())
	num									String    						@unique(map: "Transaction_number_key")
	user        				User      						@relation(fields: [userId], references: [id])
	userId      				Int
	requisites  				requisites 						@relation(fields: [requisitesId], references: [id])
	requisitesId				Int
	amount      				Float
	initiator	 					TransactionInitiator
	rate 								Float
	amountInCurrency 		Float
	amountInCurrencyFee Float
	type        				TransactionType			
	status   						TransactionStatus 		@default(PENDING)
	createdAt   	  	 	DateTime  						@default(now())
	updatedAt   	  	 	DateTime  						@updatedAt
}

model currency {
	id					Int       @id @default(autoincrement())
	name        String    @unique(map: "Currency_name_key")
	symbol      String
	createdAt   DateTime  @default(now())
	requisites  requisites[]
}

model bank_name {
	id					Int       @id @default(autoincrement())
	name        String    @unique(map: "Bank_name_key")
	icon				String?
	createdAt   DateTime  @default(now())
	requisites    requisites[]
}

model payment_method {
	id					Int       @id @default(autoincrement())
	name        String    @unique(map: "Payment_method_name_key")
	icon				String?
	createdAt   DateTime  @default(now())
	requisites    requisites[]
}

enum user_role {
  USER
  ADMIN
}

enum TransactionStatus {
	PENDING
	COMPLETED
	CANCELED
	FAILED
	REFUNDED
	DISPUTED
}

enum TransactionType {
	RECEIVE
	PAYMENT
}

enum TransactionInitiator {
	TREADER
	ADMIN
	MERCHANT
	SYSTEM
}
